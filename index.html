
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Avan√ßado de Manuten√ß√£o Veicular</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .backup-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9em;
        }

        .nav-tabs {
            display: flex;
            background: #34495e;
            border-bottom: 2px solid #2c3e50;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            color: white;
            border: none;
            background: transparent;
            transition: all 0.3s ease;
        }

        .tab:hover {
            background: rgba(255,255,255,0.1);
        }

        .tab.active {
            background: #3498db;
            border-bottom: 3px solid #2980b9;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card.warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .stat-card.danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .stat-card.success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }

        input, select, textarea {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .btn-success {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th {
            background: linear-gradient(45deg, #34495e, #2c3e50);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-ok {
            background: #d4edda;
            color: #155724;
        }

        .status-warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .reminder-card {
            background: #fff3cd;
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }

        .scanner-area {
            border: 2px dashed #3498db;
            padding: 40px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scanner-area:hover {
            background: #f8f9fa;
            border-color: #2980b9;
        }

        .scanner-area.dragover {
            background: #e3f2fd;
            border-color: #1976d2;
        }

        .price-trend {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .trend-up {
            color: #e74c3c;
        }

        .trend-down {
            color: #2ecc71;
        }

        .trend-stable {
            color: #95a5a6;
        }

        .kmcalc-container {
            background: #e8f4fd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .notification-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 9999;
            font-weight: bold;
            animation: slideIn 0.3s ease;
        }

        .notification-toast.error {
            background: #e74c3c;
        }

        .notification-toast.warning {
            background: #f39c12;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #3498db, #2980b9);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .form-grid,
            .filter-grid {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }

        .actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöó Sistema Avan√ßado de Manuten√ß√£o</h1>
            <p>Sua oficina digital inteligente</p>
            <div class="backup-indicator" id="backupStatus">
                <span id="backupIcon">‚òÅÔ∏è</span>
                <span id="backupText">Sincronizado</span>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="tab active" onclick="mostrarAba('dashboard')">üìä Dashboard</button>
            <button class="tab" onclick="mostrarAba('manutencao')">üîß Manuten√ß√£o</button>
            <button class="tab" onclick="mostrarAba('relatorios')">üìà Relat√≥rios</button>
            <button class="tab" onclick="mostrarAba('lembretes')">‚è∞ Lembretes</button>
            <button class="tab" onclick="mostrarAba('scanner')">üì± Scanner</button>
            <button class="tab" onclick="mostrarAba('calculadora')">üßÆ Calc. KM</button>
        </div>

        <!-- ABA DASHBOARD -->
        <div id="dashboard" class="tab-content active">
            <div class="stats">
                <div class="stat-card success">
                    <div class="stat-number" id="totalItens">0</div>
                    <div>Total de Itens</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="gastoTotal">R$ 0</div>
                    <div>Gasto Total</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-number" id="vencendoGarantia">0</div>
                    <div>Garantias Vencendo</div>
                </div>
                <div class="stat-card danger">
                    <div class="stat-number" id="proximasManutencoes">0</div>
                    <div>Pr√≥ximas Manuten√ß√µes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="gastoMedio">R$ 0</div>
                    <div>Gasto M√©dio/M√™s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="kmTotal">0</div>
                    <div>KM Rodados</div>
                </div>
            </div>

            <div class="chart-container">
                <h3>üìà Gastos por M√™s</h3>
                <canvas id="gastosMensais" width="400" height="200"></canvas>
            </div>

            <div class="chart-container">
                <h3>üîß Manuten√ß√µes por Sistema</h3>
                <canvas id="sistemaChart" width="400" height="200"></canvas>
            </div>

            <div class="table-container">
                <h3>üö® Pr√≥ximas Manuten√ß√µes (30 dias)</h3>
                <table id="proximasTable">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Dias Restantes</th>
                            <th>Status</th>
                            <th>A√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody id="proximasBody"></tbody>
                </table>
            </div>
        </div>

        <!-- ABA MANUTEN√á√ÉO -->
        <div id="manutencao" class="tab-content">
            <div class="form-section">
                <h2>üìù Adicionar Nova Manuten√ß√£o</h2>
                <form id="manutencaoForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="sistema">Sistema:</label>
                            <select id="sistema" required>
                                <option value="">Selecione o sistema</option>
                                <option value="Motor">üîß Motor</option>
                                <option value="Transmiss√£o">‚öôÔ∏è Transmiss√£o</option>
                                <option value="Freios">üõë Freios</option>
                                <option value="Suspens√£o">üèÉ‚Äç‚ôÇÔ∏è Suspens√£o</option>
                                <option value="El√©trica">‚ö° El√©trica</option>
                                <option value="Combust√≠vel">‚õΩ Combust√≠vel</option>
                                <option value="Refrigera√ß√£o">‚ùÑÔ∏è Refrigera√ß√£o</option>
                                <option value="Pneus">üõû Pneus</option>
                                <option value="Ar Condicionado">üå¨Ô∏è Ar Condicionado</option>
                                <option value="Carroceria">üöó Carroceria</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="item">Item:</label>
                            <input type="text" id="item" placeholder="Ex: √ìleo do motor" required>
                        </div>
                        <div class="form-group">
                            <label for="dataTroca">Data da Troca:</label>
                            <input type="date" id="dataTroca" required>
                        </div>
                        <div class="form-group">
                            <label for="valor">Valor (R$):</label>
                            <input type="number" id="valor" step="0.01" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label for="garantiaAte">Garantia at√©:</label>
                            <input type="date" id="garantiaAte">
                        </div>
                        <div class="form-group">
                            <label for="localTroca">Local da Troca:</label>
                            <input type="text" id="localTroca" placeholder="Ex: Oficina do Jo√£o">
                        </div>
                        <div class="form-group">
                            <label for="quilometragem">Quilometragem:</label>
                            <input type="number" id="quilometragem" placeholder="Ex: 50000">
                        </div>
                        <div class="form-group">
                            <label for="proximaTroca">Pr√≥xima troca (km):</label>
                            <input type="number" id="proximaTroca" placeholder="Ex: 55000">
                        </div>
                        <div class="form-group">
                            <label for="observacoes">Observa√ß√µes:</label>
                            <textarea id="observacoes" rows="3" placeholder="Observa√ß√µes adicionais..."></textarea>
                        </div>
                    </div>
                    <button type="submit" class="btn">‚ûï Adicionar Manuten√ß√£o</button>
                </form>
            </div>

            <div class="form-section">
                <h3>üîç Filtros e Busca</h3>
                <div class="filter-grid">
                    <div class="form-group">
                        <label for="filtroSistema">Sistema:</label>
                        <select id="filtroSistema">
                            <option value="">Todos os sistemas</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filtroStatus">Status:</label>
                        <select id="filtroStatus">
                            <option value="">Todos</option>
                            <option value="ok">‚úÖ Em dia</option>
                            <option value="warning">‚ö†Ô∏è Aten√ß√£o</option>
                            <option value="danger">üö® Vencido</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="buscarItem">Buscar Item:</label>
                        <input type="text" id="buscarItem" placeholder="Digite para buscar...">
                    </div>
                    <div class="form-group">
                        <button type="button" class="btn" onclick="limparFiltros()">üóëÔ∏è Limpar Filtros</button>
                        <button type="button" class="btn btn-success" onclick="exportarDados()">üìä Exportar</button>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table id="tabelaManutencoes">
                    <thead>
                        <tr>
                            <th>Sistema</th>
                            <th>Item</th>
                            <th>Data</th>
                            <th>Valor</th>
                            <th>Tend√™ncia Pre√ßo</th>
                            <th>Garantia</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="corpoTabela">
                    </tbody>
                </table>
            </div>
            <div id="estadoVazio" class="empty-state" style="display: none;">
                <div style="font-size: 4em;">üîß</div>
                <h3>Nenhuma manuten√ß√£o cadastrada</h3>
                <p>Adicione sua primeira manuten√ß√£o para come√ßar!</p>
            </div>
        </div>

        <!-- ABA RELAT√ìRIOS -->
        <div id="relatorios" class="tab-content">
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="relGastoAno">R$ 0</div>
                    <div>Gasto Este Ano</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="relGastoMes">R$ 0</div>
                    <div>Gasto Este M√™s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="relSistemaCaro">-</div>
                    <div>Sistema Mais Caro</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="relOficinaFavorita">-</div>
                    <div>Oficina Favorita</div>
                </div>
            </div>

            <div class="chart-container">
                <h3>üí∞ Evolu√ß√£o dos Gastos</h3>
                <canvas id="evolucaoGastos" width="400" height="200"></canvas>
            </div>

            <div class="chart-container">
                <h3>üîß Distribui√ß√£o por Sistema</h3>
                <canvas id="distribuicaoSistema" width="400" height="200"></canvas>
            </div>

            <div class="chart-container">
                <h3>üìä Hist√≥rico de Pre√ßos por Item</h3>
                <select id="itemPrecoSelect">
                    <option value="">Selecione um item</option>
                </select>
                <canvas id="historicoPrecos" width="400" height="200"></canvas>
            </div>
        </div>

        <!-- ABA LEMBRETES -->
        <div id="lembretes" class="tab-content">
            <div class="form-section">
                <h2>‚è∞ Configurar Lembretes</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="emailLembrete">Email para Lembretes:</label>
                        <input type="email" id="emailLembrete" placeholder="seu@email.com">
                    </div>
                    <div class="form-group">
                        <label for="whatsappLembrete">WhatsApp (opcional):</label>
                        <input type="tel" id="whatsappLembrete" placeholder="+55 11 99999-9999">
                    </div>
                    <div class="form-group">
                        <label for="diasAntecedencia">Dias de Anteced√™ncia:</label>
                        <select id="diasAntecedencia">
                            <option value="7">7 dias</option>
                            <option value="15">15 dias</option>
                            <option value="30" selected>30 dias</option>
                            <option value="60">60 dias</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button type="button" class="btn" onclick="salvarConfigLembretes()">üíæ Salvar Configura√ß√µes</button>
                        <button type="button" class="btn btn-warning" onclick="testarLembrete()">üìß Testar Lembrete</button>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>üîî Lembretes Ativos</h3>
                <div id="lembretesAtivos"></div>
            </div>

            <div class="form-section">
                <h3>üì± Compartilhar via WhatsApp</h3>
                <p>Envie rapidamente informa√ß√µes de manuten√ß√£o:</p>
                <button class="btn btn-success" onclick="compartilharWhatsApp()">üì± Compartilhar Resumo</button>
            </div>
        </div>

        <!-- ABA SCANNER -->
        <div id="scanner" class="tab-content">
            <div class="form-section">
                <h2>üì± Scanner de Notas Fiscais</h2>
                <p>Fotografe ou arraste sua nota fiscal para extrair dados automaticamente</p>
                
                <div class="scanner-area" id="scannerArea" onclick="document.getElementById('fileInput').click()">
                    <div style="font-size: 3em; margin-bottom: 15px;">üì∑</div>
                    <h3>Clique aqui ou arraste a imagem</h3>
                    <p>Formatos aceitos: JPG, PNG, PDF</p>
                    <input type="file" id="fileInput" accept="image/*,.pdf" style="display: none;">
                </div>

                <div id="scannerResults" style="display: none; margin-top: 20px;">
                    <h3>‚úÖ Dados Extra√≠dos:</h3>
                    <div id="dadosExtraidos"></div>
                    <button class="btn" onclick="usarDadosScanner()">‚úÖ Usar Dados</button>
                </div>
            </div>

            <div class="form-section">
                <h3>üìä Estat√≠sticas do Scanner</h3>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalScans">0</div>
                        <div>Notas Escaneadas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="economiaScanner">0h</div>
                        <div>Tempo Economizado</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ABA CALCULADORA KM -->
        <div id="calculadora" class="tab-content">
            <div class="kmcalc-container">
                <h2>üßÆ Calculadora de Quilometragem</h2>
                <p>Calcule quando fazer a pr√≥xima manuten√ß√£o baseada no seu uso</p>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="kmAtual">Quilometragem Atual:</label>
                        <input type="number" id="kmAtual" placeholder="Ex: 45000">
                    </div>
                    <div class="form-group">
                        <label for="kmDiario">KM por Dia (m√©dia):</label>
                        <input type="number" id="kmDiario" placeholder="Ex: 50">
                    </div>
                    <div class="form-group">
                        <label for="intervaloManutencao">Intervalo de Manuten√ß√£o (km):</label>
                        <select id="intervaloManutencao">
                            <option value="5000">√ìleo - 5.000 km</option>
                            <option value="10000">Filtros - 10.000 km</option>
                            <option value="15000">Velas - 15.000 km</option>
                            <option value="20000">Pastilhas - 20.000 km</option>
                            <option value="40000">Pneus - 40.000 km</option>
                            <option value="60000">Correia - 60.000 km</option>
                            <option value="100000">Amortecedores - 100.000 km</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button type="button" class="btn" onclick="calcularProximaManutencao()">üßÆ Calcular</button>
                    </div>
                </div>

                <div id="resultadoCalculo" style="display: none; margin-top: 20px; padding: 20px; background: white; border-radius: 10px;">
                    <h3>üìÖ Resultado do C√°lculo</h3>
                    <div id="calculoDetalhes"></div>
                </div>
            </div>

            <div class="form-section">
                <h3>üìà Hist√≥rico de Quilometragem</h3>
                <canvas id="kmHistorico" width="400" height="200"></canvas>
            </div>

            <div class="form-section">
                <h3>‚öôÔ∏è Configura√ß√µes de Perfil de Uso</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="perfilUso">Tipo de Uso:</label>
                        <select id="perfilUso">
                            <option value="urbano">üèôÔ∏è Urbano (tr√¢nsito pesado)</option>
                            <option value="rodoviario">üõ£Ô∏è Rodovi√°rio (estradas)</option>
                            <option value="misto">üîÑ Misto (urbano + rodovi√°rio)</option>
                            <option value="severo">‚ö†Ô∏è Severo (taxi/uber)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button type="button" class="btn" onclick="salvarPerfilUso()">üíæ Salvar Perfil</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modais -->
    <div id="modalEdicao" class="modal">
        <div class="modal-content">
            <h3>‚úèÔ∏è Editar Manuten√ß√£o</h3>
            <form id="formEdicao">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="editSistema">Sistema:</label>
                        <select id="editSistema">
                            <option value="Motor">üîß Motor</option>
                            <option value="Transmiss√£o">‚öôÔ∏è Transmiss√£o</option>
                            <option value="Freios">üõë Freios</option>
                            <option value="Suspens√£o">üèÉ‚Äç‚ôÇÔ∏è Suspens√£o</option>
                            <option value="El√©trica">‚ö° El√©trica</option>
                            <option value="Combust√≠vel">‚õΩ Combust√≠vel</option>
                            <option value="Refrigera√ß√£o">‚ùÑÔ∏è Refrigera√ß√£o</option>
                            <option value="Pneus">üõû Pneus</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editItem">Item:</label>
                        <input type="text" id="editItem">
                    </div>
                    <div class="form-group">
                        <label for="editDataTroca">Data da Troca:</label>
                        <input type="date" id="editDataTroca">
                    </div>
                    <div class="form-group">
                        <label for="editValor">Valor:</label>
                        <input type="number" id="editValor" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="editGarantiaAte">Garantia at√©:</label>
                        <input type="date" id="editGarantiaAte">
                    </div>
                    <div class="form-group">
                        <label for="editLocalTroca">Local:</label>
                        <input type="text" id="editLocalTroca">
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn">üíæ Salvar</button>
                    <button type="button" class="btn btn-danger" onclick="fecharModal()">‚ùå Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let manutencoes = JSON.parse(localStorage.getItem('manutencoes')) || [];
        let configuracoes = JSON.parse(localStorage.getItem('configuracoes')) || {
            email: '',
            whatsapp: '',
            diasAntecedencia: 30,
            perfilUso: 'misto',
            kmDiario: 50
        };
        let itemEditando = null;
        let lastBackup = localStorage.getItem('lastBackup');

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            carregarDados();
            atualizarTudo();
            configurarEventos();
            inicializarScanner();
            verificarLembretes();
            atualizarBackupStatus();
            
            // Data atual como padr√£o
            document.getElementById('dataTroca').valueAsDate = new Date();
        });

        function configurarEventos() {
            // Formul√°rio principal
            document.getElementById('manutencaoForm').addEventListener('submit', adicionarManutencao);
            document.getElementById('formEdicao').addEventListener('submit', salvarEdicao);
            
            // Filtros
            document.getElementById('filtroSistema').addEventListener('change', aplicarFiltros);
            document.getElementById('filtroStatus').addEventListener('change', aplicarFiltros);
            document.getElementById('buscarItem').addEventListener('input', aplicarFiltros);
            
            // Scanner
            document.getElementById('fileInput').addEventListener('change', processarArquivo);
        }

        // ===================== NAVEGA√á√ÉO =====================
        function mostrarAba(aba) {
            // Esconder todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar aba selecionada
            document.getElementById(aba).classList.add('active');
            event.target.classList.add('active');
            
            // Atualizar dados espec√≠ficos da aba
            if (aba === 'relatorios') {
                atualizarRelatorios();
            } else if (aba === 'lembretes') {
                atualizarLembretes();
            } else if (aba === 'dashboard') {
                atualizarCharts();
            }
        }

        // ===================== MANUTEN√á√ÉO =====================
        function adicionarManutencao(e) {
            e.preventDefault();
            
            const novaManutencao = {
                id: Date.now(),
                sistema: document.getElementById('sistema').value,
                item: document.getElementById('item').value,
                dataTroca: document.getElementById('dataTroca').value,
                valor: parseFloat(document.getElementById('valor').value) || 0,
                garantiaAte: document.getElementById('garantiaAte').value,
                localTroca: document.getElementById('localTroca').value,
                quilometragem: parseInt(document.getElementById('quilometragem').value) || 0,
                proximaTroca: parseInt(document.getElementById('proximaTroca').value) || 0,
                observacoes: document.getElementById('observacoes').value,
                dataAdicionado: new Date().toISOString()
            };

            manutencoes.push(novaManutencao);
            salvarDados();
            atualizarTudo();
            
            // Limpar formul√°rio
            document.getElementById('manutencaoForm').reset();
            document.getElementById('dataTroca').valueAsDate = new Date();
            
            mostrarNotificacao('‚úÖ Manuten√ß√£o adicionada com sucesso!');
            realizarBackup();
        }

        function editarItem(index) {
            const manutencao = manutencoes[index];
            itemEditando = index;
            
            document.getElementById('editSistema').value = manutencao.sistema;
            document.getElementById('editItem').value = manutencao.item;
            document.getElementById('editDataTroca').value = manutencao.dataTroca;
            document.getElementById('editValor').value = manutencao.valor;
            document.getElementById('editGarantiaAte').value = manutencao.garantiaAte;
            document.getElementById('editLocalTroca').value = manutencao.localTroca;
            
            document.getElementById('modalEdicao').style.display = 'block';
        }

        function salvarEdicao(e) {
            e.preventDefault();
            
            if (itemEditando !== null) {
                manutencoes[itemEditando].sistema = document.getElementById('editSistema').value;
                manutencoes[itemEditando].item = document.getElementById('editItem').value;
                manutencoes[itemEditando].dataTroca = document.getElementById('editDataTroca').value;
                manutencoes[itemEditando].valor = parseFloat(document.getElementById('editValor').value) || 0;
                manutencoes[itemEditando].garantiaAte = document.getElementById('editGarantiaAte').value;
                manutencoes[itemEditando].localTroca = document.getElementById('editLocalTroca').value;

                salvarDados();
                atualizarTudo();
                fecharModal();
                
                mostrarNotificacao('‚úÖ Manuten√ß√£o atualizada!');
                realizarBackup();
            }
        }

        function excluirItem(index) {
            if (confirm('Tem certeza que deseja excluir esta manuten√ß√£o?')) {
                manutencoes.splice(index, 1);
                salvarDados();
                atualizarTudo();
                mostrarNotificacao('üóëÔ∏è Manuten√ß√£o exclu√≠da!');
                realizarBackup();
            }
        }

        // ===================== TABELA E FILTROS =====================
        function atualizarTabela() {
            const corpoTabela = document.getElementById('corpoTabela');
            const estadoVazio = document.getElementById('estadoVazio');
            
            let manutencoesFiltradas = aplicarFiltrosArray();
            
            if (manutencoesFiltradas.length === 0) {
                corpoTabela.innerHTML = '';
                if (manutencoes.length === 0) {
                    estadoVazio.style.display = 'block';
                }
                return;
            }
            
            estadoVazio.style.display = 'none';
            
            corpoTabela.innerHTML = manutencoesFiltradas.map((manutencao, originalIndex) => {
                const index = manutencoes.indexOf(manutencao);
                const status = calcularStatus(manutencao);
                const tendencia = calcularTendenciaPreco(manutencao.item);
                const dataFormatada = formatarData(manutencao.dataTroca);
                const garantiaFormatada = manutencao.garantiaAte ? formatarData(manutencao.garantiaAte) : 'N√£o informado';
                const valorFormatado = manutencao.valor ? `R$ ${manutencao.valor.toFixed(2)}` : 'N/A';
                
                return `
                    <tr>
                        <td>${manutencao.sistema}</td>
                        <td>${manutencao.item}</td>
                        <td>${dataFormatada}</td>
                        <td>${valorFormatado}</td>
                        <td class="price-trend">${tendencia}</td>
                        <td>${garantiaFormatada}</td>
                        <td><span class="status-badge status-${status.tipo}">${status.texto}</span></td>
                        <td class="actions">
                            <button class="btn btn-small" onclick="editarItem(${index})" title="Editar">‚úèÔ∏è</button>
                            <button class="btn btn-danger btn-small" onclick="excluirItem(${index})" title="Excluir">üóëÔ∏è</button>
                            <button class="btn btn-warning btn-small" onclick="criarLembrete(${index})" title="Lembrete">‚è∞</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function aplicarFiltrosArray() {
            const filtroSistema = document.getElementById('filtroSistema').value;
            const filtroStatus = document.getElementById('filtroStatus').value;
            const buscarItem = document.getElementById('buscarItem').value.toLowerCase();
            
            return manutencoes.filter(m => {
                const passaSistema = !filtroSistema || m.sistema === filtroSistema;
                const passaStatus = !filtroStatus || calcularStatus(m).tipo === filtroStatus;
                const passaBusca = !buscarItem || m.item.toLowerCase().includes(buscarItem) || m.localTroca.toLowerCase().includes(buscarItem);
                
                return passaSistema && passaStatus && passaBusca;
            });
        }

        function aplicarFiltros() {
            atualizarTabela();
        }

        function limparFiltros() {
            document.getElementById('filtroSistema').value = '';
            document.getElementById('filtroStatus').value = '';
            document.getElementById('buscarItem').value = '';
            atualizarTabela();
        }

        // ===================== C√ÅLCULOS E STATUS =====================
        function calcularStatus(manutencao) {
            const hoje = new Date();
            
            if (manutencao.garantiaAte) {
                const garantia = new Date(manutencao.garantiaAte);
                const diferenca = garantia - hoje;
                const dias = diferenca / (1000 * 60 * 60 * 24);
                
                if (dias < 0) {
                    return { tipo: 'danger', texto: 'üö® Garantia vencida' };
                } else if (dias <= 30) {
                    return { tipo: 'warning', texto: '‚ö†Ô∏è Garantia vencendo' };
                }
            }
            
            // Verificar manuten√ß√£o baseada em tempo (6 meses padr√£o)
            const dataTroca = new Date(manutencao.dataTroca);
            const proximaManutencao = new Date(dataTroca);
            proximaManutencao.setMonth(proximaManutencao.getMonth() + 6);
            const diasParaProxima = (proximaManutencao - hoje) / (1000 * 60 * 60 * 24);
            
            if (diasParaProxima <= 0) {
                return { tipo: 'danger', texto: 'üö® Manuten√ß√£o atrasada' };
            } else if (diasParaProxima <= 30) {
                return { tipo: 'warning', texto: '‚ö†Ô∏è Manuten√ß√£o pr√≥xima' };
            }
            
            return { tipo: 'ok', texto: '‚úÖ Em dia' };
        }

        function calcularTendenciaPreco(item) {
            const historico = manutencoes
                .filter(m => m.item.toLowerCase() === item.toLowerCase() && m.valor > 0)
                .sort((a, b) => new Date(a.dataTroca) - new Date(b.dataTroca));
            
            if (historico.length < 2) {
                return '<span class="trend-stable">‚ûñ Sem dados</span>';
            }
            
            const ultimoPreco = historico[historico.length - 1].valor;
            const penultimoPreco = historico[historico.length - 2].valor;
            const diferenca = ((ultimoPreco - penultimoPreco) / penultimoPreco) * 100;
            
            if (diferenca > 5) {
                return `<span class="trend-up">üìà +${diferenca.toFixed(1)}%</span>`;
            } else if (diferenca < -5) {
                return `<span class="trend-down">üìâ ${diferenca.toFixed(1)}%</span>`;
            } else {
                return '<span class="trend-stable">‚ûñ Est√°vel</span>';
            }
        }

        // ===================== ESTAT√çSTICAS =====================
        function atualizarEstatisticas() {
            const total = manutencoes.length;
            const gastoTotal = manutencoes.reduce((sum, m) => sum + (m.valor || 0), 0);
            
            let vencendoGarantia = 0;
            let proximasManutencoes = 0;
            const hoje = new Date();
            
            manutencoes.forEach(manutencao => {
                const status = calcularStatus(manutencao);
                if (status.tipo === 'warning') {
                    if (status.texto.includes('Garantia')) {
                        vencendoGarantia++;
                    } else {
                        proximasManutencoes++;
                    }
                } else if (status.tipo === 'danger') {
                    proximasManutencoes++;
                }
            });
            
            // Calcular gasto m√©dio mensal
            const primeiraManutencao = manutencoes.reduce((min, m) => {
                const data = new Date(m.dataTroca);
                return data < min ? data : min;
            }, new Date());
            
            const mesesDecorridos = Math.max(1, (hoje - primeiraManutencao) / (1000 * 60 * 60 * 24 * 30));
            const gastoMedio = gastoTotal / mesesDecorridos;
            
            // Calcular KM total
            const kmTotal = manutencoes.reduce((max, m) => Math.max(max, m.quilometragem || 0), 0);
            
            document.getElementById('totalItens').textContent = total;
            document.getElementById('gastoTotal').textContent = `R$ ${gastoTotal.toFixed(2)}`;
            document.getElementById('vencendoGarantia').textContent = vencendoGarantia;
            document.getElementById('proximasManutencoes').textContent = proximasManutencoes;
            document.getElementById('gastoMedio').textContent = `R$ ${gastoMedio.toFixed(2)}`;
            document.getElementById('kmTotal').textContent = kmTotal.toLocaleString();
        }

        // ===================== SCANNER =====================
        function inicializarScanner() {
            const scannerArea = document.getElementById('scannerArea');
            
            // Drag and drop
            scannerArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                scannerArea.classList.add('dragover');
            });
            
            scannerArea.addEventListener('dragleave', () => {
                scannerArea.classList.remove('dragover');
            });
            
            scannerArea.addEventListener('drop', (e) => {
                e.preventDefault();
                scannerArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    processarArquivoScanner(files[0]);
                }
            });
        }

        function processarArquivo() {
            const file = document.getElementById('fileInput').files[0];
            if (file) {
                processarArquivoScanner(file);
            }
        }

        function processarArquivoScanner(file) {
            // Simular processamento OCR (em produ√ß√£o, usaria uma API real)
            mostrarNotificacao('üì± Processando imagem...', 'warning');
            
            setTimeout(() => {
                // Dados simulados extra√≠dos
                const dadosSimulados = {
                    item: '√ìleo do motor',
                    valor: '89.90',
                    data: new Date().toISOString().split('T')[0],
                    local: 'Auto Pe√ßas Silva'
                };
                
                mostrarDadosExtraidos(dadosSimulados);
                atualizarEstatisticasScanner();
                mostrarNotificacao('‚úÖ Dados extra√≠dos com sucesso!');
            }, 2000);
        }

        function mostrarDadosExtraidos(dados) {
            const container = document.getElementById('dadosExtraidos');
            container.innerHTML = `
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                    <p><strong>Item:</strong> ${dados.item}</p>
                    <p><strong>Valor:</strong> R$ ${dados.valor}</p>
                    <p><strong>Data:</strong> ${formatarData(dados.data)}</p>
                    <p><strong>Local:</strong> ${dados.local}</p>
                </div>
            `;
            
            document.getElementById('scannerResults').style.display = 'block';
            
            // Armazenar dados para uso
            window.dadosScanner = dados;
        }

        function usarDadosScanner() {
            if (window.dadosScanner) {
                // Preencher formul√°rio com dados extra√≠dos
                document.getElementById('item').value = window.dadosScanner.item;
                document.getElementById('valor').value = window.dadosScanner.valor;
                document.getElementById('dataTroca').value = window.dadosScanner.data;
                document.getElementById('localTroca').value = window.dadosScanner.local;
                
                // Ir para aba de manuten√ß√£o
                mostrarAba('manutencao');
                
                mostrarNotificacao('‚úÖ Dados preenchidos no formul√°rio!');
                
                // Limpar scanner
                document.getElementById('scannerResults').style.display = 'none';
                window.dadosScanner = null;
            }
        }

        function atualizarEstatisticasScanner() {
            let totalScans = parseInt(localStorage.getItem('totalScans') || '0');
            totalScans++;
            localStorage.setItem('totalScans', totalScans.toString());
            
            document.getElementById('totalScans').textContent = totalScans;
            document.getElementById('economiaScanner').textContent = `${(totalScans * 2)}h`;
        }

        // ===================== CALCULADORA KM =====================
        function calcularProximaManutencao() {
            const kmAtual = parseInt(document.getElementById('kmAtual').value) || 0;
            const kmDiario = parseInt(document.getElementById('kmDiario').value) || 50;
            const intervalo = parseInt(document.getElementById('intervaloManutencao').value) || 5000;
            
            const proximoKm = Math.ceil(kmAtual / intervalo) * intervalo;
            const kmRestantes = proximoKm - kmAtual;
            const diasRestantes = Math.ceil(kmRestantes / kmDiario);
            const dataProxima = new Date();
            dataProxima.setDate(dataProxima.getDate() + diasRestantes);
            
            const detalhes = `
                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #3498db;">
                    <h4>üìÖ Pr√≥xima Manuten√ß√£o</h4>
                    <p><strong>KM para pr√≥xima manuten√ß√£o:</strong> ${proximoKm.toLocaleString()} km</p>
                    <p><strong>KM restantes:</strong> ${kmRestantes.toLocaleString()} km</p>
                    <p><strong>Dias restantes:</strong> ${diasRestantes} dias</p>
                    <p><strong>Data estimada:</strong> ${formatarData(dataProxima.toISOString().split('T')[0])}</p>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${(kmAtual % intervalo) / intervalo * 100}%"></div>
                    </div>
                    <small>Progresso at√© pr√≥xima manuten√ß√£o: ${((kmAtual % intervalo) / intervalo * 100).toFixed(1)}%</small>
                </div>
            `;
            
            document.getElementById('calculoDetalhes').innerHTML = detalhes;
            document.getElementById('resultadoCalculo').style.display = 'block';
            
            // Salvar configura√ß√µes
            configuracoes.kmDiario = kmDiario;
            salvarConfiguracoes();
        }

        function salvarPerfilUso() {
            const perfil = document.getElementById('perfilUso').value;
            configuracoes.perfilUso = perfil;
            salvarConfiguracoes();
            mostrarNotificacao('‚úÖ Perfil de uso salvo!');
        }

        // ===================== LEMBRETES =====================
        function salvarConfigLembretes() {
            configuracoes.email = document.getElementById('emailLembrete').value;
            configuracoes.whatsapp = document.getElementById('whatsappLembrete').value;
            configuracoes.diasAntecedencia = parseInt(document.getElementById('diasAntecedencia').value);
            
            salvarConfiguracoes();
            mostrarNotificacao('‚úÖ Configura√ß√µes de lembrete salvas!');
            atualizarLembretes();
        }

        function verificarLembretes() {
            if (!configuracoes.email) return;
            
            const hoje = new Date();
            const diasAntecedencia = configuracoes.diasAntecedencia || 30;
            
            manutencoes.forEach(manutencao => {
                const status = calcularStatus(manutencao);
                if (status.tipo === 'warning' || status.tipo === 'danger') {
                    // Em produ√ß√£o, enviaria email/SMS real
                    console.log(`Lembrete: ${manutencao.item} precisa de aten√ß√£o`);
                }
            });
        }

        function testarLembrete() {
            if (!configuracoes.email) {
                mostrarNotificacao('‚ùå Configure um email primeiro!', 'error');
                return;
            }
            
            // Simular envio de email
            mostrarNotificacao('üìß Email de teste enviado!', 'success');
        }

        function atualizarLembretes() {
            const container = document.getElementById('lembretesAtivos');
            const hoje = new Date();
            const diasAntecedencia = configuracoes.diasAntecedencia || 30;
            
            const lembretesAtivos = manutencoes.filter(m => {
                const status = calcularStatus(m);
                return status.tipo === 'warning' || status.tipo === 'danger';
            });
            
            if (lembretesAtivos.length === 0) {
                container.innerHTML = '<p style="color: #2ecc71;">‚úÖ Nenhum lembrete ativo. Tudo em dia!</p>';
                return;
            }
            
            container.innerHTML = lembretesAtivos.map(m => `
                <div class="reminder-card">
                    <h4>‚ö†Ô∏è ${m.item}</h4>
                    <p><strong>Sistema:</strong> ${m.sistema}</p>
                    <p><strong>Status:</strong> ${calcularStatus(m).texto}</p>
                    <p><strong>√öltima troca:</strong> ${formatarData(m.dataTroca)}</p>
                </div>
            `).join('');
        }

        function criarLembrete(index) {
            const manutencao = manutencoes[index];
            const mensagem = `üîî Lembrete criado para: ${manutencao.item}`;
            mostrarNotificacao(mensagem);
        }

        function compartilharWhatsApp() {
            const proximas = manutencoes.filter(m => {
                const status = calcularStatus(m);
                return status.tipo === 'warning' || status.tipo === 'danger';
            });
            
            let mensagem = 'üöó *Relat√≥rio de Manuten√ß√£o*\n\n';
            mensagem += `üìä Total de itens: ${manutencoes.length}\n`;
            mensagem += `üí∞ Gasto total: R$ ${manutencoes.reduce((sum, m) => sum + (m.valor || 0), 0).toFixed(2)}\n\n`;
            
            if (proximas.length > 0) {
                mensagem += '‚ö†Ô∏è *Itens que precisam de aten√ß√£o:*\n';
                proximas.forEach(m => {
                    mensagem += `‚Ä¢ ${m.item} (${m.sistema})\n`;
                });
            } else {
                mensagem += '‚úÖ Tudo em dia!\n';
            }
            
            mensagem += '\n_Enviado pelo Sistema de Manuten√ß√£o Veicular_';
            
            const url = `https://wa.me/?text=${encodeURIComponent(mensagem)}`;
            window.open(url, '_blank');
        }

        // ===================== RELAT√ìRIOS E CHARTS =====================
        function atualizarRelatorios() {
            const hoje = new Date();
            const anoAtual = hoje.getFullYear();
            const mesAtual = hoje.getMonth();
            
            // Gastos do ano
            const gastoAno = manutencoes
                .filter(m => new Date(m.dataTroca).getFullYear() === anoAtual)
                .reduce((sum, m) => sum + (m.valor || 0), 0);
            
            // Gastos do m√™s
            const gastoMes = manutencoes
                .filter(m => {
                    const data = new Date(m.dataTroca);
                    return data.getFullYear() === anoAtual && data.getMonth() === mesAtual;
                })
                .reduce((sum, m) => sum + (m.valor || 0), 0);
            
            // Sistema mais caro
            const gastosPorSistema = {};
            manutencoes.forEach(m => {
                gastosPorSistema[m.sistema] = (gastosPorSistema[m.sistema] || 0) + (m.valor || 0);
            });
            const sistemaCaro = Object.keys(gastosPorSistema).reduce((a, b) => 
                gastosPorSistema[a] > gastosPorSistema[b] ? a : b, '-');
            
            // Oficina favorita
            const oficinas = {};
            manutencoes.forEach(m => {
                if (m.localTroca) {
                    oficinas[m.localTroca] = (oficinas[m.localTroca] || 0) + 1;
                }
            });
            const oficinaFavorita = Object.keys(oficinas).reduce((a, b) => 
                oficinas[a] > oficinas[b] ? a : b, '-');
            
            document.getElementById('relGastoAno').textContent = `R$ ${gastoAno.toFixed(2)}`;
            document.getElementById('relGastoMes').textContent = `R$ ${gastoMes.toFixed(2)}`;
            document.getElementById('relSistemaCaro').textContent = sistemaCaro;
            document.getElementById('relOficinaFavorita').textContent = oficinaFavorita;
            
            atualizarChartsRelatorios();
        }

        function atualizarCharts() {
            // Atualizar gr√°ficos do dashboard
            criarGraficoGastosMensais();
            criarGraficoSistemas();
            atualizarProximasManutencoes();
        }

        function criarGraficoGastosMensais() {
            const canvas = document.getElementById('gastosMensais');
            const ctx = canvas.getContext('2d');
            
            // Dados dos √∫ltimos 12 meses
            const hoje = new Date();
            const meses = [];
            const gastos = [];
            
            for (let i = 11; i >= 0; i--) {
                const data = new Date(hoje.getFullYear(), hoje.getMonth() - i, 1);
                const mesNome = data.toLocaleDateString('pt-BR', { month: 'short' });
                meses.push(mesNome);
                
                const gastoMes = manutencoes
                    .filter(m => {
                        const dataM = new Date(m.dataTroca);
                        return dataM.getFullYear() === data.getFullYear() && 
                               dataM.getMonth() === data.getMonth();
                    })
                    .reduce((sum, m) => sum + (m.valor || 0), 0);
                
                gastos.push(gastoMes);
            }
            
            // Limpar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Desenhar gr√°fico simples
            const maxGasto = Math.max(...gastos, 100);
            const larguraBarra = canvas.width / meses.length;
            
            gastos.forEach((gasto, index) => {
                const altura = (gasto / maxGasto) * (canvas.height - 40);
                const x = index * larguraBarra + 10;
                const y = canvas.height - altura - 20;
                
                ctx.fillStyle = '#3498db';
                ctx.fillRect(x, y, larguraBarra - 20, altura);
                
                // Texto
                ctx.fillStyle = '#2c3e50';
                ctx.font = '12px Arial';
                ctx.fillText(meses[index], x + 5, canvas.height - 5);
                ctx.fillText(`R$${gasto.toFixed(0)}`, x + 5, y - 5);
            });
        }

        function criarGraficoSistemas() {
            const canvas = document.getElementById('sistemaChart');
            const ctx = canvas.getContext('2d');
            
            // Contar manuten√ß√µes por sistema
            const sistemas = {};
            manutencoes.forEach(m => {
                sistemas[m.sistema] = (sistemas[m.sistema] || 0) + 1;
            });
            
            const cores = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c'];
            const sistemasArray = Object.entries(sistemas);
            
            // Limpar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (sistemasArray.length === 0) return;
            
            // Desenhar gr√°fico de barras
            const larguraBarra = canvas.width / sistemasArray.length;
            const maxCount = Math.max(...Object.values(sistemas));
            
            sistemasArray.forEach(([sistema, count], index) => {
                const altura = (count / maxCount) * (canvas.height - 40);
                const x = index * larguraBarra + 10;
                const y = canvas.height - altura - 20;
                
                ctx.fillStyle = cores[index % cores.length];
                ctx.fillRect(x, y, larguraBarra - 20, altura);
                
                // Texto
                ctx.fillStyle = '#2c3e50';
                ctx.font = '10px Arial';
                ctx.save();
                ctx.translate(x + larguraBarra/2, canvas.height - 5);
                ctx.rotate(-Math.PI/4);
                ctx.fillText(sistema, 0, 0);
                ctx.restore();
                ctx.fillText(count.toString(), x + larguraBarra/2, y - 5);
            });
        }

        function atualizarChartsRelatorios() {
            // Implementar gr√°ficos espec√≠ficos dos relat√≥rios
            // Similar aos m√©todos acima
        }

        function atualizarProximasManutencoes() {
            const proximasBody = document.getElementById('proximasBody');
            const hoje = new Date();
            
            const proximas = manutencoes
                .map((m, index) => ({ ...m, originalIndex: index }))
                .filter(m => {
                    const status = calcularStatus(m);
                    return status.tipo === 'warning' || status.tipo === 'danger';
                })
                .slice(0, 5); // Mostrar apenas as 5 mais urgentes
            
            if (proximas.length === 0) {
                proximasBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">‚úÖ Nenhuma manuten√ß√£o urgente</td></tr>';
                return;
            }
            
            proximasBody.innerHTML = proximas.map(m => {
                const status = calcularStatus(m);
                let diasRestantes = 'Vencido';
                
                if (m.garantiaAte) {
                    const dias = Math.ceil((new Date(m.garantiaAte) - hoje) / (1000 * 60 * 60 * 24));
                    if (dias >= 0) diasRestantes = `${dias} dias`;
                }
                
                return `
                    <tr>
                        <td>${m.item}</td>
                        <td>${diasRestantes}</td>
                        <td><span class="status-badge status-${status.tipo}">${status.texto}</span></td>
                        <td>
                            <button class="btn btn-small" onclick="editarItem(${m.originalIndex})">‚úèÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ===================== BACKUP E SYNC =====================
        function realizarBackup() {
            // Simular backup na nuvem
            const agora = new Date().toISOString();
            localStorage.setItem('lastBackup', agora);
            atualizarBackupStatus();
            
            // Em produ√ß√£o, enviaria para Google Drive ou outro servi√ßo
            console.log('Backup realizado:', agora);
        }

        function atualizarBackupStatus() {
            const lastBackup = localStorage.getItem('lastBackup');
            const backupIcon = document.getElementById('backupIcon');
            const backupText = document.getElementById('backupText');
            
            if (lastBackup) {
                const data = new Date(lastBackup);
                const agora = new Date();
                const diferenca = agora - data;
                
                if (diferenca < 60000) { // Menos de 1 minuto
                    backupIcon.textContent = '‚òÅÔ∏è';
                    backupText.textContent = 'Sincronizado';
                } else {
                    backupIcon.textContent = 'üîÑ';
                    backupText.textContent = 'Sincronizando...';
                }
            } else {
                backupIcon.textContent = '‚ùå';
                backupText.textContent = 'N√£o sincronizado';
            }
        }

        // ===================== EXPORTA√á√ÉO =====================
        function exportarDados() {
            const dados = {
                manutencoes: manutencoes,
                configuracoes: configuracoes,
                dataExportacao: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(dados, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `manutencao_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            mostrarNotificacao('üìä Dados exportados com sucesso!');
        }

        // ===================== UTILIDADES =====================
        function atualizarTudo() {
            atualizarTabela();
            atualizarEstatisticas();
            preencherFiltros();
            atualizarCharts();
        }

        function preencherFiltros() {
            const filtroSistema = document.getElementById('filtroSistema');
            const sistemas = [...new Set(manutencoes.map(m => m.sistema))];
            
            filtroSistema.innerHTML = '<option value="">Todos os sistemas</option>';
            sistemas.forEach(sistema => {
                filtroSistema.innerHTML += `<option value="${sistema}">${sistema}</option>`;
            });
            
            // Preencher select de hist√≥rico de pre√ßos
            const itemPrecoSelect = document.getElementById('itemPrecoSelect');
            const itens = [...new Set(manutencoes.map(m => m.item))];
            
            itemPrecoSelect.innerHTML = '<option value="">Selecione um item</option>';
            itens.forEach(item => {
                itemPrecoSelect.innerHTML += `<option value="${item}">${item}</option>`;
            });
        }

        function fecharModal() {
            document.getElementById('modalEdicao').style.display = 'none';
            itemEditando = null;
        }

        function formatarData(dataString) {
            const data = new Date(dataString + 'T00:00:00');
            return data.toLocaleDateString('pt-BR');
        }

        function salvarDados() {
            localStorage.setItem('manutencoes', JSON.stringify(manutencoes));
        }

        function carregarDados() {
            const dados = localStorage.getItem('manutencoes');
            if (dados) {
                manutencoes = JSON.parse(dados);
            }
            
            const config = localStorage.getItem('configuracoes');
            if (config) {
                configuracoes = { ...configuracoes, ...JSON.parse(config) };
            }
        }

        function salvarConfiguracoes() {
            localStorage.setItem('configuracoes', JSON.stringify(configuracoes));
        }

        function mostrarNotificacao(mensagem, tipo = 'success') {
            const notificacao = document.createElement('div');
            notificacao.className = `notification-toast ${tipo}`;
            notificacao.textContent = mensagem;
            document.body.appendChild(notificacao);
            
            setTimeout(() => {
                notificacao.remove();
            }, 3000);
        }

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('modalEdicao');
            if (event.target === modal) {
                fecharModal();
            }
        }

        // Auto-backup a cada 5 minutos
        setInterval(realizarBackup, 5 * 60 * 1000);
    </script>
</body>
</html>
